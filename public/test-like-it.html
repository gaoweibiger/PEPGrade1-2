<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯• "like it" è¿è¯»ä¿®æ­£</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
        }
        .test-item {
            background: rgba(255, 255, 255, 0.1);
            margin: 15px 0;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .original {
            font-weight: bold;
            color: #ffeb3b;
            margin-bottom: 10px;
        }
        .corrected {
            color: #4caf50;
            font-style: italic;
            margin-bottom: 15px;
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        .status {
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ æµ‹è¯• "like it" è¿è¯»ä¿®æ­£ (æ–°æ–¹æ³•)</h1>
        
        <div class="controls">
            <button onclick="testAllSentences()">ğŸ”Š æµ‹è¯•æ‰€æœ‰å¥å­</button>
            <button onclick="stopSpeech()">â¹ï¸ åœæ­¢æ’­æ”¾</button>
        </div>
        
        <div class="status" id="status">å‡†å¤‡æµ‹è¯•...</div>
        
        <div id="testResults"></div>
    </div>

    <script type="module">
        // å¯¼å…¥è¯­éŸ³ä¿®æ­£å™¨
        import { PronunciationCorrector } from '../src/utils/pronunciationCorrector.ts';

        // æµ‹è¯•å¥å­
        const testSentences = [
            "Do you like it too?",
            "I really like it a lot.",
            "Can you see it clearly?",
            "Please try it now.",
            "Do you want it back?",
            "I need it today.",
            "Let's make it better.",
            "You can have it all.",
            "I love it so much.",
            "Just take it easy."
        ];

        let currentSpeech = null;

        // åœæ­¢è¯­éŸ³
        window.stopSpeech = function() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('status').textContent = 'å·²åœæ­¢æ’­æ”¾';
            }
        };

        // è¯­éŸ³æ’­æ”¾å‡½æ•°
        function speak(text, rate = 0.8) {
            return new Promise((resolve, reject) => {
                if (currentSpeech) {
                    speechSynthesis.cancel();
                }

                currentSpeech = new SpeechSynthesisUtterance(text);
                currentSpeech.rate = rate;
                currentSpeech.pitch = 1;
                currentSpeech.volume = 1;

                // å°è¯•ä½¿ç”¨è‹±è¯­è¯­éŸ³
                const voices = speechSynthesis.getVoices();
                const englishVoice = voices.find(voice => 
                    voice.lang.startsWith('en') && 
                    (voice.name.includes('Google') || voice.name.includes('Microsoft'))
                );
                if (englishVoice) {
                    currentSpeech.voice = englishVoice;
                }

                currentSpeech.onend = () => {
                    currentSpeech = null;
                    resolve();
                };
                currentSpeech.onerror = (error) => {
                    currentSpeech = null;
                    reject(error);
                };

                speechSynthesis.speak(currentSpeech);
            });
        }

        // æµ‹è¯•å•ä¸ªå¥å­
        async function testSentence(original, index) {
            const corrected = PronunciationCorrector.correctPronunciation(original, {
                enableLinkingCorrection: true,
                debugMode: true
            });

            const testItem = document.createElement('div');
            testItem.className = 'test-item';
            testItem.innerHTML = `
                <div class="original">åŸå¥: ${original}</div>
                <div class="corrected">ä¿®æ­£: ${corrected}</div>
                <button onclick="playOriginal('${original}', ${index})">ğŸ”Š æ’­æ”¾åŸå¥</button>
                <button onclick="playCorrected('${corrected}', ${index})">ğŸ”Š æ’­æ”¾ä¿®æ­£å¥</button>
                <div id="status-${index}" style="margin-top: 10px; font-size: 14px;"></div>
            `;

            return { element: testItem, original, corrected };
        }

        // æ’­æ”¾åŸå¥
        window.playOriginal = async function(text, index) {
            const statusEl = document.getElementById(`status-${index}`);
            statusEl.textContent = 'ğŸ”Š æ’­æ”¾åŸå¥ä¸­...';
            statusEl.style.color = '#ffeb3b';
            
            try {
                await speak(text);
                statusEl.textContent = 'âœ… åŸå¥æ’­æ”¾å®Œæˆ';
                statusEl.style.color = '#4caf50';
            } catch (error) {
                statusEl.textContent = 'âŒ æ’­æ”¾å¤±è´¥';
                statusEl.style.color = '#f44336';
            }
        };

        // æ’­æ”¾ä¿®æ­£å¥
        window.playCorrected = async function(text, index) {
            const statusEl = document.getElementById(`status-${index}`);
            statusEl.textContent = 'ğŸ”Š æ’­æ”¾ä¿®æ­£å¥ä¸­...';
            statusEl.style.color = '#ffeb3b';
            
            try {
                await speak(text);
                statusEl.textContent = 'âœ… ä¿®æ­£å¥æ’­æ”¾å®Œæˆ';
                statusEl.style.color = '#4caf50';
            } catch (error) {
                statusEl.textContent = 'âŒ æ’­æ”¾å¤±è´¥';
                statusEl.style.color = '#f44336';
            }
        };

        // æµ‹è¯•æ‰€æœ‰å¥å­
        window.testAllSentences = async function() {
            const resultsContainer = document.getElementById('testResults');
            const statusEl = document.getElementById('status');
            
            resultsContainer.innerHTML = '';
            statusEl.textContent = 'ğŸ”„ æ­£åœ¨ç”Ÿæˆæµ‹è¯•ç»“æœ...';

            for (let i = 0; i < testSentences.length; i++) {
                const result = await testSentence(testSentences[i], i);
                resultsContainer.appendChild(result.element);
            }

            statusEl.textContent = `âœ… å·²ç”Ÿæˆ ${testSentences.length} ä¸ªæµ‹è¯•é¡¹ç›®ï¼Œç‚¹å‡»æŒ‰é’®è¯•å¬æ•ˆæœ`;
        };

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨ç”Ÿæˆæµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            // ç­‰å¾…è¯­éŸ³APIå‡†å¤‡å°±ç»ª
            if (speechSynthesis.getVoices().length === 0) {
                speechSynthesis.addEventListener('voiceschanged', () => {
                    testAllSentences();
                });
            } else {
                testAllSentences();
            }
        });
    </script>
</body>
</html>
