<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³åŠŸèƒ½æµ‹è¯• - å¾®ä¿¡å…¼å®¹æ€§æ£€æµ‹</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        .status-good { color: #4ade80; }
        .status-warning { color: #fbbf24; }
        .status-error { color: #f87171; }
        .test-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .test-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }
        .result.success {
            background: rgba(74, 222, 128, 0.2);
            border: 1px solid #4ade80;
            color: #4ade80;
        }
        .result.error {
            background: rgba(248, 113, 113, 0.2);
            border: 1px solid #f87171;
            color: #f87171;
        }
        .result.warning {
            background: rgba(251, 191, 36, 0.2);
            border: 1px solid #fbbf24;
            color: #fbbf24;
        }
        .solution {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        .solution h4 {
            color: #3b82f6;
            margin: 0 0 10px 0;
        }
        .solution ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .solution li {
            margin: 5px 0;
            color: #bfdbfe;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸµ è¯­éŸ³åŠŸèƒ½å…¼å®¹æ€§æµ‹è¯•</h1>
            <p>æ£€æµ‹æ‚¨çš„æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½</p>
        </div>

        <div class="status-card">
            <h3>ğŸ“± ç¯å¢ƒæ£€æµ‹</h3>
            <div class="status-item">
                <span>æµè§ˆå™¨ç±»å‹:</span>
                <span id="browser-type">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="status-item">
                <span>è®¾å¤‡ç±»å‹:</span>
                <span id="device-type">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="status-item">
                <span>è¯­éŸ³APIæ”¯æŒ:</span>
                <span id="speech-support">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="status-item">
                <span>ç”¨æˆ·äº¤äº’çŠ¶æ€:</span>
                <span id="interaction-status">æ£€æµ‹ä¸­...</span>
            </div>
            <div id="wechat-info" style="display: none;">
                <div class="status-item">
                    <span>å¾®ä¿¡ç‰ˆæœ¬:</span>
                    <span id="wechat-version">æ£€æµ‹ä¸­...</span>
                </div>
                <div class="status-item">
                    <span>å°ç¨‹åºç¯å¢ƒ:</span>
                    <span id="miniprogram-status">æ£€æµ‹ä¸­...</span>
                </div>
            </div>
        </div>

        <div class="status-card">
            <h3>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="activateInteraction()">
                æ¿€æ´»ç”¨æˆ·äº¤äº’
            </button>
            <button class="test-button" onclick="testSpeech()" id="test-btn">
                æµ‹è¯•è¯­éŸ³æ’­æ”¾
            </button>
            <div id="test-result"></div>
        </div>

        <div id="solution-card" class="solution" style="display: none;">
            <h4>ğŸ’¡ è§£å†³æ–¹æ¡ˆ</h4>
            <div id="solution-content"></div>
        </div>
    </div>

    <script>
        // ç¯å¢ƒæ£€æµ‹
        const isWeChat = /MicroMessenger/i.test(navigator.userAgent);
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        const isAndroid = /Android/i.test(navigator.userAgent);
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const speechSupported = 'speechSynthesis' in window;
        const isMiniProgram = window.__wxjs_environment === 'miniprogram';
        
        let userInteracted = false;

        // è·å–å¾®ä¿¡ç‰ˆæœ¬
        function getWeChatVersion() {
            if (!isWeChat) return null;
            const match = navigator.userAgent.match(/MicroMessenger\/(\d+)\.(\d+)\.(\d+)/);
            return match ? `${match[1]}.${match[2]}.${match[3]}` : 'æœªçŸ¥';
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            document.getElementById('browser-type').innerHTML = 
                isWeChat ? '<span class="status-warning">ğŸ”¥ å¾®ä¿¡æµè§ˆå™¨</span>' : '<span class="status-good">ğŸŒ æ ‡å‡†æµè§ˆå™¨</span>';
            
            document.getElementById('device-type').innerHTML = 
                isMobile ? '<span class="status-good">ğŸ“± ç§»åŠ¨è®¾å¤‡</span>' : '<span class="status-good">ğŸ’» æ¡Œé¢è®¾å¤‡</span>';
            
            document.getElementById('speech-support').innerHTML = 
                speechSupported ? '<span class="status-good">âœ… æ”¯æŒ</span>' : '<span class="status-error">âŒ ä¸æ”¯æŒ</span>';
            
            document.getElementById('interaction-status').innerHTML = 
                userInteracted ? '<span class="status-good">âœ… å·²æ¿€æ´»</span>' : '<span class="status-warning">âš ï¸ å¾…æ¿€æ´»</span>';

            if (isWeChat) {
                document.getElementById('wechat-info').style.display = 'block';
                const version = getWeChatVersion();
                const versionSupported = version && parseFloat(version) >= 7.0;
                
                document.getElementById('wechat-version').innerHTML = 
                    versionSupported ? `<span class="status-good">${version}</span>` : `<span class="status-error">${version}</span>`;
                
                document.getElementById('miniprogram-status').innerHTML = 
                    isMiniProgram ? '<span class="status-error">âŒ æ˜¯</span>' : '<span class="status-good">âœ… å¦</span>';
            }
        }

        // æ¿€æ´»ç”¨æˆ·äº¤äº’
        function activateInteraction() {
            userInteracted = true;
            updateStatus();
            
            // å°è¯•åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡ï¼ˆå¾®ä¿¡æµè§ˆå™¨éœ€è¦ï¼‰
            if (isWeChat) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    if (audioContext.state === 'suspended') {
                        audioContext.resume();
                    }
                } catch (error) {
                    console.warn('éŸ³é¢‘ä¸Šä¸‹æ–‡åˆå§‹åŒ–å¤±è´¥:', error);
                }
            }
        }

        // æµ‹è¯•è¯­éŸ³åŠŸèƒ½
        async function testSpeech() {
            const testBtn = document.getElementById('test-btn');
            const resultDiv = document.getElementById('test-result');
            const solutionCard = document.getElementById('solution-card');
            const solutionContent = document.getElementById('solution-content');
            
            testBtn.disabled = true;
            testBtn.textContent = 'æµ‹è¯•ä¸­...';
            resultDiv.innerHTML = '';
            solutionCard.style.display = 'none';

            // åŸºç¡€æ£€æŸ¥
            if (!speechSupported) {
                showResult('error', 'æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½', getSolution('unsupported'));
                return;
            }

            if (isMiniProgram) {
                showResult('error', 'å¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸æ”¯æŒè¯­éŸ³åŠŸèƒ½', getSolution('miniprogram'));
                return;
            }

            if (isWeChat && !userInteracted) {
                showResult('warning', 'éœ€è¦å…ˆæ¿€æ´»ç”¨æˆ·äº¤äº’', getSolution('interaction'));
                return;
            }

            // å®é™…è¯­éŸ³æµ‹è¯•
            try {
                const utterance = new SpeechSynthesisUtterance('Hello, this is a speech test!');
                utterance.lang = 'en-US';
                utterance.rate = isWeChat ? 0.7 : 0.8;
                utterance.volume = 1;

                let speechStarted = false;
                let speechEnded = false;

                const timeout = setTimeout(() => {
                    if (!speechStarted) {
                        showResult('error', 'è¯­éŸ³æ’­æ”¾å¯åŠ¨è¶…æ—¶', getSolution('timeout'));
                    } else if (!speechEnded) {
                        showResult('warning', 'è¯­éŸ³æ’­æ”¾å·²å¼€å§‹ï¼Œä½†å¯èƒ½å¬ä¸åˆ°å£°éŸ³', getSolution('volume'));
                    }
                }, 3000);

                utterance.onstart = () => {
                    speechStarted = true;
                    console.log('è¯­éŸ³æ’­æ”¾å¼€å§‹');
                };

                utterance.onend = () => {
                    speechEnded = true;
                    clearTimeout(timeout);
                    showResult('success', 'è¯­éŸ³æ’­æ”¾æˆåŠŸï¼åŠŸèƒ½å·¥ä½œæ­£å¸¸', null);
                };

                utterance.onerror = (event) => {
                    clearTimeout(timeout);
                    showResult('error', `è¯­éŸ³æ’­æ”¾å‡ºé”™: ${event.error}`, getSolution(event.error));
                };

                speechSynthesis.cancel();
                speechSynthesis.speak(utterance);

            } catch (error) {
                showResult('error', `è¯­éŸ³æµ‹è¯•å¼‚å¸¸: ${error.message}`, getSolution('exception'));
            }
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showResult(type, message, solution) {
            const testBtn = document.getElementById('test-btn');
            const resultDiv = document.getElementById('test-result');
            const solutionCard = document.getElementById('solution-card');
            const solutionContent = document.getElementById('solution-content');
            
            testBtn.disabled = false;
            testBtn.textContent = 'é‡æ–°æµ‹è¯•';
            
            resultDiv.innerHTML = `<div class="result ${type}">${message}</div>`;
            
            if (solution) {
                solutionContent.innerHTML = solution;
                solutionCard.style.display = 'block';
            }
        }

        // è·å–è§£å†³æ–¹æ¡ˆ
        function getSolution(errorType) {
            switch (errorType) {
                case 'unsupported':
                    return `
                        <p>æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ Web Speech APIã€‚</p>
                        <ul>
                            <li>å»ºè®®ä½¿ç”¨ Chromeã€Safariã€Edge æˆ– Firefox æµè§ˆå™¨</li>
                            <li>ç¡®ä¿æµè§ˆå™¨ç‰ˆæœ¬æ˜¯æœ€æ–°çš„</li>
                            <li>å¦‚æœåœ¨å¾®ä¿¡ä¸­ï¼Œå¯ä»¥ç‚¹å‡»å³ä¸Šè§’é€‰æ‹©"åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"</li>
                        </ul>
                    `;
                case 'miniprogram':
                    return `
                        <p>å¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸æ”¯æŒç½‘é¡µè¯­éŸ³åŠŸèƒ½ã€‚</p>
                        <ul>
                            <li>è¯·åœ¨å¾®ä¿¡ä¸­ç›´æ¥æ‰“å¼€é“¾æ¥ï¼Œè€Œä¸æ˜¯åœ¨å°ç¨‹åºä¸­</li>
                            <li>æˆ–è€…å¤åˆ¶é“¾æ¥åˆ°å…¶ä»–æµè§ˆå™¨ä¸­æ‰“å¼€</li>
                        </ul>
                    `;
                case 'interaction':
                    return `
                        <p>å¾®ä¿¡æµè§ˆå™¨éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾è¯­éŸ³ã€‚</p>
                        <ul>
                            <li>è¯·å…ˆç‚¹å‡»"æ¿€æ´»ç”¨æˆ·äº¤äº’"æŒ‰é’®</li>
                            <li>ç„¶åå†æµ‹è¯•è¯­éŸ³åŠŸèƒ½</li>
                        </ul>
                    `;
                case 'timeout':
                    return `
                        <p>è¯­éŸ³æ’­æ”¾å¯åŠ¨è¶…æ—¶ï¼Œå¯èƒ½çš„åŸå› ï¼š</p>
                        <ul>
                            <li>è®¾å¤‡éŸ³é‡è¢«å…³é—­</li>
                            <li>æµè§ˆå™¨é˜»æ­¢äº†éŸ³é¢‘æ’­æ”¾</li>
                            <li>ç½‘ç»œè¿æ¥é—®é¢˜</li>
                            <li>å°è¯•åˆ·æ–°é¡µé¢é‡æ–°æµ‹è¯•</li>
                        </ul>
                    `;
                case 'volume':
                    return `
                        <p>è¯­éŸ³å·²å¼€å§‹æ’­æ”¾ä½†å¯èƒ½å¬ä¸åˆ°å£°éŸ³ï¼š</p>
                        <ul>
                            <li>æ£€æŸ¥è®¾å¤‡éŸ³é‡è®¾ç½®</li>
                            <li>æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦é™éŸ³</li>
                            <li>ç¡®ä¿æ²¡æœ‰å…¶ä»–åº”ç”¨å ç”¨éŸ³é¢‘</li>
                        </ul>
                    `;
                case 'synthesis-failed':
                    return `
                        <p>è¯­éŸ³åˆæˆå¼•æ“å¤±è´¥ï¼š</p>
                        <ul>
                            <li>å°è¯•åˆ·æ–°é¡µé¢</li>
                            <li>å…³é—­å…¶ä»–æ­£åœ¨æ’­æ”¾éŸ³é¢‘çš„åº”ç”¨</li>
                            <li>æ£€æŸ¥ç½‘ç»œè¿æ¥</li>
                            <li>å°è¯•é™ä½æ’­æ”¾é€Ÿåº¦</li>
                        </ul>
                    `;
                default:
                    return `
                        <p>é‡åˆ°æœªçŸ¥é”™è¯¯ï¼Œå»ºè®®ï¼š</p>
                        <ul>
                            <li>åˆ·æ–°é¡µé¢é‡è¯•</li>
                            <li>æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§</li>
                            <li>å°è¯•å…¶ä»–æµè§ˆå™¨</li>
                            <li>ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸</li>
                        </ul>
                    `;
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus();
            
            // è‡ªåŠ¨ç›‘å¬ç”¨æˆ·äº¤äº’
            const events = ['touchstart', 'click', 'keydown'];
            const handleInteraction = () => {
                if (!userInteracted) {
                    activateInteraction();
                    events.forEach(event => {
                        document.removeEventListener(event, handleInteraction);
                    });
                }
            };
            
            events.forEach(event => {
                document.addEventListener(event, handleInteraction, { once: true });
            });
        });
    </script>
</body>
</html>
